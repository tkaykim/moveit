# 토스페이먼츠 API 키 정리 (공식 문서·에러 코드 기준)

## 1. 클라이언트 키 두 종류 — 용도가 다름

토스페이먼츠 공식 문서(document 222, SDK 초기화)와 에러 코드(document 204) 기준:

| 용도 | 사용할 클라이언트 키 | 잘못 쓰면 발생하는 에러 |
|------|----------------------|-------------------------|
| **결제위젯** (`widgets()`, `renderPaymentMethods`, `widgets.requestPayment`) | **결제위젯 연동 키** | `NOT_SUPPORTED_API_INDIVIDUAL_KEY` — "결제위젯 연동 키의 클라이언트 키로 SDK를 연동해주세요. **API 개별 연동 키는 지원하지 않습니다.**" |
| **결제창** (`payment().requestPayment`), **빌링** (`payment().requestBillingAuth`), **브랜드페이** | **API 개별 연동 키** | `NOT_SUPPORTED_WIDGET_KEY` — "**API 개별 연동 키**의 클라이언트 키로 SDK를 연동해주세요. 결제위젯 연동 키는 지원하지 않습니다." |

- **결제위젯을 쓰는 화면** → 반드시 **결제위젯 연동 키**로 `TossPayments(clientKey)` 초기화.
- **결제창만 쓰는 화면** / **빌링(카드·계좌 등록)** → **API 개별 연동 키**로 초기화.

같은 프로젝트에서 결제위젯과 결제창/빌링을 둘 다 쓰면, **클라이언트 키를 용도별로 구분**해 써야 합니다.

---

## 2. 클라이언트 키 ↔ 시크릿 키 매칭

공식 문서에서 반복해서 나오는 내용:

- "**클라이언트 키와 매칭된 시크릿 키**를 사용하고 있는지 확인하세요."
- "결제 요청에 사용한 **클라이언트 키**와 결제 승인에 사용한 **시크릿 키**가 **매칭된 키값**인지 확인하세요."
- "API 키는 토스페이먼츠에 로그인한 뒤 **개발자센터의 API 키 메뉴**에서 확인할 수 있어요."

즉, **클라이언트 키와 시크릿 키는 한 쌍**이어야 합니다.  
결제 요청 시 A 클라이언트 키를 썼으면, 결제 승인(및 빌링키 발급 등)에는 **A와 쌍인 시크릿 키**를 써야 합니다.

- **결제위젯**으로 결제한 경우: 문서(예: PayPal 연동)에 "**결제위젯 연동 키 > 시크릿 키** 를 사용해요"라고 되어 있음 → 결제 승인에는 **결제위젯 연동 키와 쌍인 시크릿 키** 사용.
- **API 개별 연동 키**로 결제창/빌링을 쓴 경우: **API 개별 연동 키와 쌍인 시크릿 키** 사용.

개발자센터에서 **결제위젯 연동 키**와 **API 개별 연동 키**가 각각 별도 시크릿 키를 가질 수 있으므로,  
두 종류를 다 쓰는 프로젝트는 **환경 변수도 용도별로 두 개** 두는 것이 안전합니다.

---

## 3. 이 프로젝트에서의 대응

이 프로젝트는 **수강권 결제에 결제위젯**을, **구독·빌링에 결제창/빌링**을 사용합니다. 사용 키는 **`NEXT_PUBLIC_TOSS_CLIENT_KEY`**, **`TOSS_SECRET_KEY`** 두 개만 씁니다.

- **수강권 구매 후 예약**: **결제위젯** (`TossPayments(clientKey).widgets()`) — 앱 내 모달에서 결제하여 외부 브라우저 이탈 방지. 세션 예약 페이지에서 `NEXT_PUBLIC_TOSS_CLIENT_KEY`로 위젯 초기화.
- **구독·카드 등록·빌링**: 결제창·빌링 (동일한 `NEXT_PUBLIC_TOSS_CLIENT_KEY`)
- **결제 승인** (수강권·구독·환불 등): `TOSS_SECRET_KEY` 하나로 처리

### 환경 변수 (필수 2개)

| 변수명 | 용도 | 사용 위치 |
|--------|------|-----------|
| `NEXT_PUBLIC_TOSS_CLIENT_KEY` | 클라이언트 키 (위젯·결제창·빌링 공용) | 수강권 결제 위젯 모달, 구독 모달, 카드 등록, 빌링 |
| `TOSS_SECRET_KEY` | 위 클라이언트 키와 쌍인 시크릿 | `/api/tickets/payment-confirm`, 빌링키 발급, 자동결제, 환불 등 |

**위젯 사용 시 `NOT_SUPPORTED_API_INDIVIDUAL_KEY`가 나오면**: 공식 문서상 결제위젯은 "결제위젯 연동 키"를 쓰도록 안내하고 있습니다. 개발자센터 API 키 메뉴에서 **결제위젯 연동 키**를 확인한 뒤, 동일한 `NEXT_PUBLIC_TOSS_CLIENT_KEY` 자리에 넣어 사용할 수 있습니다.

---

## 4. 참고 — 공식 문서 인용

- **SDK 초기화 (document 222)**  
  "사용하고 싶은 제품에 따라 **필요한 클라이언트 키 종류가 다른데요**. … **결제위젯을 연동한다면 결제위젯 연동 키** 를 사용하세요. **브랜드페이, 결제창, 자동결제(빌링)를 연동한다면 API 개별 연동 키** 를 사용하세요."

- **에러 코드 (document 204)**  
  - 결제위젯: `NOT_SUPPORTED_API_INDIVIDUAL_KEY` — "결제위젯 연동 키의 클라이언트 키로 SDK를 연동해주세요. API 개별 연동 키는 지원하지 않습니다."  
  - 결제창/브랜드페이: `NOT_SUPPORTED_WIDGET_KEY` — "API 개별 연동 키의 클라이언트 키로 SDK를 연동해주세요. 결제위젯 연동 키는 지원하지 않습니다."

- **결제 승인 등**  
  "클라이언트 키와 **매칭된 시크릿 키**를 사용하고 있는지 확인하세요."

이 정리대로 적용하면, "결제위젯 연동 키로 SDK 연동" / "API 개별 연동 키는 지원하지 않음" / "클라이언트·시크릿 키 매칭" 요구사항에 모두 대응됩니다.
